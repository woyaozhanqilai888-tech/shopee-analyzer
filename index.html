<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopee GMV Max æ™ºèƒ½åˆ†æå¤§å¸ˆ - æœ€ç»ˆä¿®æ­£ç‰ˆ</title>
    <script crossorigin src="[https://unpkg.com/react@18/umd/react.production.min.js](https://unpkg.com/react@18/umd/react.production.min.js)"></script>
    <script crossorigin src="[https://unpkg.com/react-dom@18/umd/react-dom.production.min.js](https://unpkg.com/react-dom@18/umd/react-dom.production.min.js)"></script>
    <script src="[https://unpkg.com/@babel/standalone/babel.min.js](https://unpkg.com/@babel/standalone/babel.min.js)"></script>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <style>
        @import url('[https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap)');
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: #fcfcfc; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(229, 231, 235, 0.5); }
        /* çŠ¶æ€ç¯é¢œè‰²ï¼šç¡®ä¿ CSS ç±»åå­˜åœ¨ */
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 6px; border: 2px solid white; }
        .dot-idle { background-color: #d1d5db; }
        .dot-loading { background-color: #fbbf24; animation: pulse 1.5s infinite; }
        .dot-success { background-color: #10b981; box-shadow: 0 0 8px rgba(16, 185, 129, 0.6); }
        .dot-error { background-color: #ef4444; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const DEFAULT_PROXY = '[https://cors-anywhere.herokuapp.com/](https://cors-anywhere.herokuapp.com/)';

        // é¢œè‰²é…ç½®ï¼šChatGPT ç»¿è‰², DeepSeek è“è‰², Gemini æ©™è‰²
        const platformMeta = {
            openai: { name: 'ChatGPT', color: 'bg-emerald-500', text: 'text-emerald-600', model: 'gpt-4o' },
            deepseek: { name: 'DeepSeek', color: 'bg-blue-600', text: 'text-blue-600', model: 'deepseek-chat' },
            gemini: { name: 'Gemini', color: 'bg-orange-500', text: 'text-orange-600', model: 'gemini-1.5-flash' }
        };

        const ShopeeAdAnalyzer = () => {
            const [analysis, setAnalysis] = useState(null);
            const [aiLoading, setAiLoading] = useState(false);
            const [proxy, setProxy] = useState(DEFAULT_PROXY);
            const [apiKeys, setApiKeys] = useState({ openai: '', deepseek: '', gemini: '' });
            const [apiStatus, setApiStatus] = useState({ openai: 'idle', deepseek: 'idle', gemini: 'idle' });
            const [showSettings, setShowSettings] = useState(false);
            const [multiAiResults, setMultiAiResults] = useState({});
            const [proxyActive, setProxyActive] = useState(false);

            useEffect(() => {
                const savedKeys = localStorage.getItem('shopee_api_keys');
                const savedProxy = localStorage.getItem('shopee_proxy') || DEFAULT_PROXY;
                setProxy(savedProxy);
                checkProxy(savedProxy);
                if (savedKeys) {
                    const keys = JSON.parse(savedKeys);
                    setApiKeys(keys);
                    Object.keys(keys).forEach(p => { if (keys[p]) validateKey(p, keys[p], savedProxy); });
                }
            }, []);

            const checkProxy = async (pUrl) => {
                try {
                    const res = await fetch(pUrl + '[https://google.com](https://google.com)', { method: 'HEAD' });
                    setProxyActive(res.ok);
                } catch (e) { setProxyActive(false); }
            };

            const validateKey = async (platform, key, pUrl) => {
                setApiStatus(prev => ({ ...prev, [platform]: 'loading' }));
                try {
                    // ä¿®æ­£è·¯å¾„æ‹¼æ¥é€»è¾‘
                    const base = pUrl.endsWith('/') ? pUrl : pUrl + '/';
                    let endpoint = platform === 'openai' ? '[https://api.openai.com/v1/models](https://api.openai.com/v1/models)' : 
                                   platform === 'deepseek' ? '[https://api.deepseek.com/models](https://api.deepseek.com/models)' : 
                                   `https://generativelanguage.googleapis.com/v1beta/models?key=${key}`;
                    const headers = platform === 'gemini' ? {} : { 'Authorization': `Bearer ${key}` };
                    const res = await fetch(base + endpoint, { method: 'GET', headers });
                    setApiStatus(prev => ({ ...prev, [platform]: res.ok ? 'success' : 'error' }));
                } catch (e) { setApiStatus(prev => ({ ...prev, [platform]: 'error' })); }
            };

            const parseCSV = (text) => {
                const lines = text.split(/\r?\n/).filter(l => l.trim());
                const hIndex = lines.findIndex(l => l.includes('Impression') && l.includes('Expense'));
                if (hIndex === -1) return null;
                const headers = lines[hIndex].split(',').map(h => h.trim());
                
                let stats = { spend: 0, imp: 0, clk: 0, ord: 0, gmv: 0 };
                lines.slice(hIndex + 1).forEach(line => {
                    const vals = line.split(',');
                    const getNum = (name) => {
                        const idx = headers.indexOf(name);
                        return idx > -1 ? parseFloat(vals[idx]?.replace(/[^0-9.]/g, '')) || 0 : 0;
                    };
                    stats.spend += getNum('Expense');
                    stats.imp += getNum('Impression');
                    stats.clk += getNum('Clicks');
                    stats.ord += getNum('Conversions');
                    stats.gmv += getNum('GMV');
                });
                return stats;
            };

            const handleRunAnalysis = async () => {
                const active = Object.entries(apiKeys).filter(([p, k]) => k && apiStatus[p] === 'success');
                if (active.length === 0) return alert('è¯·ç¡®ä¿ API è®¾ç½®ä¸­å¿ƒè‡³å°‘æœ‰ä¸€ä¸ªç»¿ç¯çŠ¶æ€ï¼');

                setAiLoading(true);
                setMultiAiResults({});

                // å¼ºåˆ¶æ ¼å¼åŒ–æ•°æ®ï¼Œé˜²æ­¢ NaN ç ´å Prompt
                const roas = analysis.spend > 0 ? (analysis.gmv / analysis.spend).toFixed(2) : "0.00";
                const ctr = analysis.imp > 0 ? (analysis.clk / analysis.imp * 100).toFixed(2) : "0.00";
                const cvr = analysis.clk > 0 ? (analysis.ord / analysis.clk * 100).toFixed(2) : "0.00";

                const prompt = `åˆ†æShopeeå¹¿å‘Šï¼šROASä¸º${roas}, ç‚¹å‡»ç‡ä¸º${ctr}%, è½¬åŒ–ç‡ä¸º${cvr}%ã€‚è¯·ç»™3æ¡å»ºè®®ï¼Œåªè¿”å›æ ‡å‡†JSONæ ¼å¼: {"suggestions":[{"title":"æ ‡é¢˜","content":"å»ºè®®"}]}`;

                for (const [platform, key] of active) {
                    try {
                        const base = proxy.endsWith('/') ? proxy : proxy + '/';
                        let url = '', body = {}, headers = { 'Content-Type': 'application/json' };

                        if (platform === 'openai' || platform === 'deepseek') {
                            url = base + (platform === 'openai' ? '[https://api.openai.com/v1/chat/completions](https://api.openai.com/v1/chat/completions)' : '[https://api.deepseek.com/v1/chat/completions](https://api.deepseek.com/v1/chat/completions)');
                            headers['Authorization'] = `Bearer ${key}`;
                            body = { model: platformMeta[platform].model, messages: [{ role: 'user', content: prompt }], temperature: 0.7 };
                        } else if (platform === 'gemini') {
                            url = base + `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
                            body = { contents: [{ parts: [{ text: prompt }] }] };
                        }

                        const res = await fetch(url, { method: 'POST', headers, body: JSON.stringify(body) });
                        if (!res.ok) throw new Error(`HTTP ${res.status}`);
                        
                        const jsonData = await res.json();
                        let text = platform === 'gemini' ? jsonData.candidates[0].content.parts[0].text : jsonData.choices[0].message.content;
                        
                        // ä¿®æ­£ï¼šæ›´å¼ºåŠ›çš„æ­£åˆ™è¡¨è¾¾å¼æå– JSONï¼Œé˜²æ­¢ Markdown å¹²æ‰°
                        const match = text.match(/\{[\s\S]*\}/);
                        if (match) {
                            setMultiAiResults(prev => ({ ...prev, [platform]: { status: 'success', data: JSON.parse(match[0]) } }));
                        } else { throw new Error('JSON è§£æå¤±è´¥'); }
                    } catch (e) {
                        console.error(`AI é”™è¯¯ [${platform}]:`, e);
                        setMultiAiResults(prev => ({ ...prev, [platform]: { status: 'error' } }));
                    }
                }
                setAiLoading(false);
            };

            return (
                <div className="max-w-6xl mx-auto px-6 py-10">
                    <header className="flex justify-between items-center mb-10">
                        <div>
                            <h1 className="text-3xl font-black text-gray-900 tracking-tighter italic">Shopee <span className="text-orange-600">AI PRO</span></h1>
                            <div className="flex gap-4 mt-2">
                                {Object.keys(apiKeys).map(p => (
                                    <div key={p} className="flex items-center text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                                        <span className={`status-dot dot-${apiStatus[p]}`} /> {platformMeta[p].name}
                                    </div>
                                ))}
                            </div>
                        </div>
                        <button onClick={() => setShowSettings(true)} className="p-4 bg-white shadow-xl rounded-2xl hover:scale-105 transition-all text-xl">âš™ï¸</button>
                    </header>

                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-md p-4">
                            <div className="bg-white rounded-[40px] p-10 w-full max-w-md shadow-2xl animate-in zoom-in duration-300">
                                <h2 className="text-2xl font-bold mb-8 flex justify-between">è®¾ç½®ä¸­å¿ƒ <button onClick={() => setShowSettings(false)}>âœ•</button></h2>
                                <div className="mb-8 p-5 rounded-2xl bg-orange-50 border border-orange-100 flex justify-between items-center">
                                    <span className="text-xs font-bold text-gray-500 uppercase">CORS ä»£ç†: {proxyActive ? 'å·²æ¿€æ´»' : 'å¾…å¤„ç†'}</span>
                                    {!proxyActive && <a href="[https://cors-anywhere.herokuapp.com/corsdemo](https://cors-anywhere.herokuapp.com/corsdemo)" target="_blank" className="bg-orange-600 text-white text-[10px] px-4 py-2 rounded-xl font-black shadow-lg" onClick={() => setTimeout(()=>checkProxy(proxy), 2000)}>ç«‹å³ç‚¹å‡»æ¿€æ´»</a>}
                                </div>
                                <div className="space-y-6">
                                    {Object.keys(apiKeys).map(k => (
                                        <div key={k}>
                                            <div className="flex justify-between mb-1">
                                                <label className="text-[10px] font-black text-gray-400 uppercase">{k} API KEY</label>
                                                <span className={`text-[9px] font-bold uppercase ${apiStatus[k] === 'success' ? 'text-emerald-500' : 'text-gray-400'}`}>{apiStatus[k]}</span>
                                            </div>
                                            <input type="password" value={apiKeys[k]} onChange={e => setApiKeys({...apiKeys, [k]: e.target.value})} className="w-full bg-gray-50 border-2 border-transparent focus:border-orange-500 rounded-2xl px-5 py-3 text-sm outline-none transition-all" />
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => {
                                    localStorage.setItem('shopee_api_keys', JSON.stringify(apiKeys));
                                    localStorage.setItem('shopee_proxy', proxy);
                                    Object.keys(apiKeys).forEach(p => validateKey(p, apiKeys[p], proxy));
                                    setShowSettings(false);
                                }} className="w-full mt-10 bg-black text-white font-black py-4 rounded-2xl shadow-xl hover:bg-gray-800 transition-all">ä¿å­˜å¹¶éªŒè¯é…ç½®</button>
                            </div>
                        </div>
                    )}

                    {!analysis ? (
                        <div className="border-4 border-dashed border-gray-100 rounded-[40px] p-24 text-center glass-card hover:border-orange-200 transition-all cursor-pointer">
                            <input type="file" accept=".csv" onChange={(e) => {
                                const reader = new FileReader();
                                reader.onload = (evt) => {
                                    const res = parseCSV(evt.target.result);
                                    if(res) setAnalysis(res); else alert("CSV æ ¼å¼ä¸å…¼å®¹ï¼Œè¯·ç¡®è®¤æ˜¯åŸå§‹æŠ¥è¡¨ã€‚");
                                };
                                reader.readAsText(e.target.files[0]);
                            }} id="csv-upload" className="hidden" />
                            <label htmlFor="csv-upload" className="cursor-pointer block group">
                                <div className="text-8xl mb-6 group-hover:scale-110 transition-transform">ğŸ“Š</div>
                                <p className="text-xl font-black text-gray-800 tracking-tight">ä¸Šä¼ æ‚¨çš„ Shopee CSV æŠ¥è¡¨</p>
                                <p className="text-sm text-gray-400 mt-2 font-medium">æ”¯æŒ Thailand ç«™è‹±æ–‡ç‰ˆåŸå§‹æ–‡ä»¶</p>
                            </label>
                        </div>
                    ) : (
                        <div className="space-y-10 animate-in fade-in slide-in-from-bottom-5">
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                                {[
                                    { l: 'å¹¿å‘ŠèŠ±è´¹', v: analysis.spend.toFixed(2), c: 'text-orange-600' },
                                    { l: 'ROAS', v: (analysis.gmv/analysis.spend).toFixed(2), c: 'text-emerald-600' },
                                    { l: 'ç‚¹å‡»ç‡', v: (analysis.clk/analysis.imp*100).toFixed(2) + '%', c: 'text-blue-600' },
                                    { l: 'é”€å”®é¢', v: analysis.gmv.toFixed(2), c: 'text-purple-600' }
                                ].map((s, i) => (
                                    <div key={i} className="glass-card p-8 rounded-[35px] text-center shadow-sm hover:shadow-lg transition-all">
                                        <p className="text-[11px] font-black text-gray-400 uppercase tracking-widest mb-2">{s.l}</p>
                                        <p className={`text-3xl font-black ${s.c}`}>{s.v}</p>
                                    </div>
                                ))}
                            </div>

                            <div className="flex justify-center">
                                <button onClick={handleRunAnalysis} disabled={aiLoading} className="bg-orange-600 text-white px-14 py-5 rounded-[20px] font-black shadow-2xl hover:scale-105 active:scale-95 transition-all">
                                    {aiLoading ? 'AI å®éªŒå®¤æ­£åœ¨è¯»å–æ•°æ®...' : 'ğŸš€ å¯åŠ¨å¤š AI æ·±åº¦è”è¯Š'}
                                </button>
                            </div>

                            <div className="grid md:grid-cols-3 gap-8">
                                {Object.keys(platformMeta).map(p => multiAiResults[p] && (
                                    <div key={p} className="glass-card rounded-[40px] overflow-hidden shadow-2xl flex flex-col border-t-8 border-transparent transition-all">
                                        <div className={`${platformMeta[p].color} px-6 py-4 text-white text-[11px] font-black text-center uppercase tracking-widest`}>{platformMeta[p].name} åˆ†ææŠ¥å‘Š</div>
                                        <div className="p-8 flex-1 bg-white/50 text-[13px] leading-relaxed">
                                            {multiAiResults[p].status === 'success' ? (
                                                <div className="space-y-6">
                                                    {multiAiResults[p].data.suggestions.map((s, idx) => (
                                                        <div key={idx}><h4 className={`font-black text-sm mb-1 ${platformMeta[p].text}`}>â— {s.title}</h4><p className="text-gray-500 font-medium italic">{s.content}</p></div>
                                                    ))}
                                                </div>
                                            ) : <div className="text-red-500 font-bold text-center py-10 text-xs italic">API å“åº”å¼‚å¸¸ï¼Œè¯·é‡æ–°éªŒè¯ Keyã€‚</div>}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="text-center pt-10 pb-20"><button onClick={() => { setAnalysis(null); setMultiAiResults({}); }} className="text-gray-400 text-[10px] font-black uppercase underline underline-offset-8">é‡ç½®æ•°æ®æ–‡ä»¶</button></div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<ShopeeAdAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>
